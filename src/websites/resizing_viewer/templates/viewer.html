<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resize Quality Viewer</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <nav class="topbar">
    <div class="brand">Resize Quality Viewer</div>
    <div class="hint">Output size fixed • Mode auto-detects per file</div>
  </nav>

  <main class="container">
    <section class="panel">
      <form action="/preview" method="post" enctype="multipart/form-data" class="form">
        <div class="field">
          <label>Mode hint</label>
          <select name="mode">
            <option value="rgb" {{ 'selected' if mode == 'rgb' else '' }}>RGB</option>
            <option value="edge" {{ 'selected' if mode == 'edge' else '' }}>Edge (grayscale)</option>
          </select>
          <span class="note">Each file is auto-classified as RGB/Edge; this is a hint.</span>
        </div>

        <div class="field readonly">
          <label>Target size</label>
          <div class="sizebox">
            <input type="text" value="{{ target_w if target_w else 512 }}" readonly />
            <span>×</span>
            <input type="text" value="{{ target_h if target_h else 512 }}" readonly />
          </div>
          <span class="note">Configured in server; locked for consistency.</span>
        </div>

        <div class="field">
          <label>Select images</label>
          <div class="uploader">
            <input id="file-input" type="file" name="images" multiple accept="image/*" />
            <label for="file-input" class="button">Choose files</label>
            <span class="uploader-note">Drag & drop supported</span>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="primary">Preview</button>
        </div>
      </form>
    </section>

    {% if items %}
    <section class="results">
      {% for item in items %}
        <article class="card">
          <header class="card-header">
            <div class="filename">{{ item.filename }}</div>
            <div class="sizes">Original: {{ item.orig_size }} → Resized: {{ item.new_size }}</div>
          </header>

          {% if item.error %}
            <div class="error">Error: {{ item.error }}</div>
          {% else %}
          <div class="pair">
            <figure class="imgbox">
              <figcaption>Original</figcaption>
              <img src="{{ item.original_url }}" alt="original" />
            </figure>
            <figure class="imgbox">
              <figcaption>Resized</figcaption>
              <img src="{{ item.resized_url }}" alt="resized" />
            </figure>
          </div>
          {% endif %}
        </article>
      {% endfor %}
    </section>
    {% endif %}
  </main>

  <footer class="footer">
    <div>Flask • Pillow • OpenCV — Letterbox preserves aspect ratio; edges use bilinear (downscale) and nearest (upscale).</div>
  </footer>

  <script>
    // Drag & drop enhancement
    const input = document.getElementById('file-input');
    const panel = document.querySelector('.panel');
    ['dragenter','dragover'].forEach(evt => panel.addEventListener(evt, e => { e.preventDefault(); panel.classList.add('drag'); }));
    ['dragleave','drop'].forEach(evt => panel.addEventListener(evt, e => { e.preventDefault(); panel.classList.remove('drag'); }));
    panel.addEventListener('drop', e => { input.files = e.dataTransfer.files; });
  </script>
</body>
</html>
